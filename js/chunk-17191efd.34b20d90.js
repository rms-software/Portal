(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-17191efd"],{"071f":function(t,e,n){"use strict";n("7eb9")},"73c5":function(t,e,n){"use strict";var r=n("1da1"),a=(n("96cf"),n("5ce5"));e["a"]={updateProduct:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a["a"].post("products/update",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),getAllProducts:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a["a"].get("products");case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),getProduct:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a["a"].get("products/".concat(e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),deleteProduct:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a["a"].delete("products/".concat(e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),getAllProductOptions:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a["a"].get("options/".concat(e,"/all"));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()}},"7eb9":function(t,e,n){},"89c7":function(t,e,n){"use strict";n("fafb")},"9f83":function(t,e,n){"use strict";n("b333")},a5c2:function(t,e,n){},b333:function(t,e,n){},b715:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"box"}},[n("div",{attrs:{id:"box-title"},on:{click:t.toggleCollapse}},[t._v(" "+t._s(t.title)+" "),t.collapsable?n("span",{class:{collapsed:t.isCollapsed},attrs:{id:"collapser"}},[n("unicon",{attrs:{name:"angle-double-up"}})],1):t._e()]),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.isCollapsed,expression:"!isCollapsed"}],attrs:{id:"box-body"}},[t._t("default")],2)])},a=[],i={props:{title:{type:String,default:""},collapsable:{type:Boolean,default:!1}},data:function(){return{isCollapsed:!1}},methods:{toggleCollapse:function(){this.isCollapsed=!this.isCollapsed}}},o=i,s=(n("e105"),n("2877")),c=Object(s["a"])(o,r,a,!1,null,"2c986695",null);e["a"]=c.exports},bf2e:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("input",{ref:"image-uploader",attrs:{type:"file",id:"actual-btn",hidden:""}}),n("div",{staticClass:"image-picker-overlay box",style:"background: url("+t.value+") no-repeat;",on:{click:t.pickImage}},[n("unicon",{staticClass:"content",attrs:{name:"camera"}})],1)])},a=[];n("96cf");const i=t=>{const e=t.replace(/^data:image\/\w+;base64,/,"").length;return(e-814)/1.37},o=t=>t.split(";")[0].match(/jpeg|png|gif/)[0],s=t=>t.replace(/^data:image\/\w+;base64,/,""),c=t=>`data:${t};base64,`;var u={size:i,mime:o,data:s,prefix:c};const d=(t,e="image/jpeg")=>{const n=window.atob(t),r=[];for(let a=0;a<n.length;a++)r[a]=n.charCodeAt(a);return new window.Blob([new Uint8Array(r)],{type:e})},l=(t,e,n)=>{const r=document.createElement("canvas"),a=r.getContext("2d");return r.width=t,r.height=e,i=>{if(!n||n>8)return a.drawImage(i,0,0,r.width,r.height),r;switch(n>4&&(r.width=e,r.height=t),n){case 2:a.translate(t,0),a.scale(-1,1);break;case 3:a.translate(t,e),a.rotate(Math.PI);break;case 4:a.translate(0,e),a.scale(1,-1);break;case 5:a.rotate(.5*Math.PI),a.scale(1,-1);break;case 6:a.rotate(.5*Math.PI),a.translate(0,-e);break;case 7:a.rotate(.5*Math.PI),a.translate(t,-e),a.scale(-1,1);break;case 8:a.rotate(-.5*Math.PI),a.translate(-t,0);break}return n>4?a.drawImage(i,0,0,r.height,r.width):a.drawImage(i,0,0,r.width,r.height),r}},p=(t,e=.75)=>{const n=t.toDataURL("image/jpeg",e);return n},m=t=>({KB:t/1e3,MB:t/1e6});var h={base64ToFile:d,imageToCanvas:l,canvasToBase64:p,size:m};const f=t=>new Promise((e,n)=>{const r=new window.FileReader;r.addEventListener("load",t=>e(t.target.result),!1),r.addEventListener("error",n,!1),r.readAsDataURL(t)});var g={load:f};const v=t=>new Promise((e,n)=>{const r=new window.Image;r.addEventListener("load",()=>e(r),!1),r.addEventListener("error",n,!1),r.src=t}),b=(t,e)=>(n,r)=>{if(!t&&!e)return{width:n,height:r};const a=n/r,i=t/e;let o,s;return a>i?(o=Math.min(n,t),s=o/a):(s=Math.min(r,e),o=s*a),{width:o,height:s}};var w={load:v,resize:b};class x{constructor({quality:t=.75,size:e=2,maxWidth:n=1920,maxHeight:r=1920,resize:a=!0,rotate:i=!1}){this.start=window.performance.now(),this.end=null,this.alt=null,this.ext=null,this.startSize=null,this.startWidth=null,this.startHeight=null,this.size=1e3*e*1e3,this.endSize=null,this.endWidth=null,this.endHeight=null,this.iterations=0,this.base64prefix=null,this.quality=t,this.resize=a,this.maxWidth=n,this.maxHeight=r,this.orientation=1,this.rotate=i}}var P=x;const y=t=>new Promise(e=>{const n=new window.FileReader;n.onload=function(t){var n=new DataView(t.target.result);65496!==n.getUint16(0,!1)&&e(-2);const r=n.byteLength;let a=2;while(a<r){const t=n.getUint16(a,!1);if(a+=2,65505===t){1165519206!==n.getUint32(a+=2,!1)&&e(-1);const t=18761===n.getUint16(a+=6,!1);a+=n.getUint32(a+4,t);const r=n.getUint16(a,t);a+=2;for(let i=0;i<r;i++)274===n.getUint16(a+12*i,t)&&e(n.getUint16(a+12*i+8,t))}else{if(65280!==(65280&t))break;a+=n.getUint16(a,!1)}}e(-1)},n.readAsArrayBuffer(t.slice(0,65536))});var _={orientation:y};class k{attach(t,e){return new Promise(n=>{const r=document.querySelector(t);r.setAttribute("accept","image/*"),r.addEventListener("change",t=>{const r=this.compress([...t.target.files],e);n(r)},!1)})}compress(t,e){return Promise.all(t.map(t=>I(t,e)))}static convertBase64ToFile(t,e){return h.base64ToFile(t,e)}}function z(t,e,n=1,r,a=1,i=1){const o=h.canvasToBase64(t,n),s=u.size(o);return s>r||n>a?z(t,s,n-.1,r,a,i+1):o}async function I(t,e){const n=new P(e);return n.start=window.performance.now(),n.alt=t.name,n.ext=t.type,n.startSize=t.size,n.orientation=n.rotate?await _.orientation(t):0,O(n)(await g.load(t))}function O(t){return async e=>{const n=await w.load(e);if(t.startWidth=n.naturalWidth,t.startHeight=n.naturalHeight,t.resize){const{width:e,height:r}=w.resize(t.maxWidth,t.maxHeight)(n.naturalWidth,n.naturalHeight);t.endWidth=e,t.endHeight=r}else t.endWidth=n.naturalWidth,t.endHeight=n.naturalHeight;const r=h.imageToCanvas(t.endWidth,t.endHeight,t.orientation)(n);t.iterations=1,t.base64prefix=u.prefix(t.ext);const a=await z(r,t.startSize,t.quality,t.size,t.minQuality,t.iterations);t.finalSize=u.size(a),t.end=window.performance.now();const i=t.end-t.start;return{data:u.data(a),prefix:t.base64prefix,elapsedTimeInSeconds:i/1e3,alt:t.alt,initialSizeInMb:h.size(t.startSize).MB,endSizeInMb:h.size(t.finalSize).MB,ext:t.ext,quality:t.quality,endWidthInPx:t.endWidth,endHeightInPx:t.endHeight,initialWidthInPx:t.startWidth,initialHeightInPx:t.startHeight,sizeReducedInPercent:(t.startSize-t.finalSize)/t.startSize*100,iterations:t.iterations}}}var C=new k,R={data:function(){return{}},props:["value"],mounted:function(){var t=this;C.attach("#actual-btn",{size:.04,quality:.75}).then((function(e){var n=e[0];t.$emit("input",n.prefix+n.data),console.log(n.data.length)}))},methods:{pickImage:function(){this.$refs["image-uploader"].click()}}},B=R,S=(n("89c7"),n("2877")),H=Object(S["a"])(B,r,a,!1,null,"39802f3a",null);e["a"]=H.exports},cf46:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("table",[n("thead",[t._t("head")],2),n("tbody",[t._t("body")],2)])},a=[],i={name:"Table.vue"},o=i,s=(n("9f83"),n("2877")),c=Object(s["a"])(o,r,a,!1,null,"2108937e",null);e["a"]=c.exports},e105:function(t,e,n){"use strict";n("a5c2")},f246:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"product"}},[n("Box",{attrs:{title:"General information",collapsable:""}},[n("div",{attrs:{id:"general-product-info"}},[t._v(" Product name "),n("br"),n("input",{directives:[{name:"model",rawName:"v-model",value:t.form.name,expression:"form.name"}],attrs:{type:"text"},domProps:{value:t.form.name},on:{input:function(e){e.target.composing||t.$set(t.form,"name",e.target.value)}}}),n("br"),n("br"),t._v(" Product description "),n("br"),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.description,expression:"form.description"}],domProps:{value:t.form.description},on:{input:function(e){e.target.composing||t.$set(t.form,"description",e.target.value)}}}),n("br"),n("br"),t._v(" Product image "),n("br"),n("ImageUploader",{attrs:{id:"image-uploader"},model:{value:t.form.image,callback:function(e){t.$set(t.form,"image",e)},expression:"form.image"}})],1)]),n("Box",{attrs:{title:"Product options",collapsable:""}},[n("div",[n("div",{attrs:{id:"pricing-method-add"}},[n("button",{staticClass:"btn add",on:{click:t.addNumericProductOption}},[t._v("+ Numeric")]),t._v("  "),n("button",{staticClass:"btn add"},[t._v("+ Dropdown")]),t._v("  "),n("button",{staticClass:"btn add"},[t._v("+ Checkbox")]),t._v("  ")]),t.numericProductOptions.length>0?n("div",{attrs:{id:"numeric-pricings"}},[n("h2",[t._v("Numeric options")]),n("Table",{scopedSlots:t._u([{key:"head",fn:function(){return[n("tr",[n("th",[t._v("Option name")]),n("th",[t._v("Pricing behaviour")]),n("th")])]},proxy:!0},{key:"body",fn:function(){return t._l(t.numericProductOptions,(function(e){return n("tr",[n("td",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"option.name"}],domProps:{value:e.name},on:{input:function(n){n.target.composing||t.$set(e,"name",n.target.value)}}})]),n("td",[n("select",t._l(Object.entries(t.pricingBehaviourMap),(function(e){var r=e[0],a=e[1];return n("option",{domProps:{value:r}},[t._v(t._s(a))])})),0)]),n("td",[n("button",{staticClass:"btn delete"},[t._v(" Delete ")])])])}))},proxy:!0}],null,!1,3648717192)})],1):t._e()])]),n("button",{staticClass:"btn add text",on:{click:t.submitForm}},[n("unicon",{attrs:{name:t.form.id?"save":"plus",fill:"white"}}),t._v(" "+t._s(t.form.id?"Edit":"Add")+" product ")],1)],1)},a=[],i=n("1da1"),o=(n("96cf"),n("4de4"),n("d3b7"),n("b715")),s=n("cf46"),c=n("bf2e"),u=n("73c5"),d={components:{Box:o["a"],Table:s["a"],ImageUploader:c["a"]},data:function(){return{pricingBehaviourMap:{basePrice:"Base price",addative:"Addative",ignored:"Ignored"},trigger:0,form:{id:null,name:"",description:"",image:"",basePrice:0,productOptions:[]}}},computed:{numericProductOptions:function(){this.trigger;return this.form.productOptions.filter((function(t){return"numeric"===t.inputType}))}},mounted:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.$route.params.productId,"new"===n){e.next=12;break}return e.prev=2,e.next=5,u["a"].getProduct(n);case 5:t.form=e.sent,t.form.productOptions=[],e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](2),notifications.add("error","Something went wrong retrieving this product");case 12:case"end":return e.stop()}}),e,null,[[2,9]])})))()},methods:{submitForm:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u["a"].updateProduct(t.form);case 2:return e.next=4,t.$router.push("/rms/products");case 4:t.$router.go(1),notifications.add("info","New product created");case 6:case"end":return e.stop()}}),e)})))()},addNumericProductOption:function(){this.form.productOptions.push({inputType:"numeric",pricingBehaviour:"basePrice",name:"New option"}),this.trigger+=1}}},l=d,p=(n("071f"),n("2877")),m=Object(p["a"])(l,r,a,!1,null,"6257f3d6",null);e["default"]=m.exports},fafb:function(t,e,n){}}]);
//# sourceMappingURL=chunk-17191efd.34b20d90.js.map